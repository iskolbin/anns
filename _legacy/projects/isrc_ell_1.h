#ifndef ANNS_TASK
#define ANNS_TASK

#define N_SENSORS 199
#define C_h 0.005

double u_sensors_199_exact[] = {0.014583, 0.029163999999999999, 0.043739, 0.058306999999999998, 0.072866, 0.087411000000000003, 0.101942, 0.116455, 0.13094800000000001, 0.14541899999999999, 0.15986400000000001, 0.17428199999999999, 0.18867100000000001, 0.20302600000000001, 0.21734700000000001, 0.23163, 0.24587300000000001, 0.26007400000000003, 0.274229, 0.28833700000000001, 0.302396, 0.31640099999999999, 0.33035199999999998, 0.34424500000000002, 0.35807800000000001, 0.37184899999999999, 0.38555400000000001, 0.39919199999999999, 0.41276099999999999, 0.42625600000000002, 0.43967699999999998, 0.45301999999999998, 0.466283, 0.479464, 0.49255900000000002, 0.50556699999999999, 0.518486, 0.53131099999999998, 0.54404200000000003, 0.55667500000000003, 0.56920800000000005, 0.58163900000000002, 0.59396400000000005, 0.606182, 0.61829100000000004, 0.63028600000000001, 0.64216700000000004, 0.65393000000000001, 0.66557299999999997, 0.67709399999999997, 0.68848900000000002, 0.69975699999999996, 0.71089599999999997, 0.72190100000000001, 0.73277199999999998, 0.74350499999999997, 0.75409800000000005, 0.76454900000000003, 0.77485400000000004, 0.78501200000000004, 0.79502099999999998, 0.80487600000000004, 0.814577, 0.82411999999999996, 0.83350299999999999, 0.84272400000000003, 0.85177899999999995, 0.86066699999999996, 0.86938599999999999, 0.87793100000000002, 0.88630200000000003, 0.89449500000000004, 0.90250799999999998, 0.91033900000000001, 0.91798400000000002, 0.92544199999999999, 0.93271099999999996, 0.93978600000000001, 0.94666700000000004, 0.95335000000000003, 0.95983300000000005, 0.96611400000000003, 0.97218899999999997, 0.97805699999999995, 0.98371600000000003, 0.98916099999999996, 0.99439200000000005, 0.99940499999999999, 1.0041979999999999, 1.008769, 1.0131140000000001, 1.0172319999999999, 1.0211209999999999, 1.0247759999999999, 1.028197, 1.03138, 1.0343230000000001, 1.0370239999999999, 1.039479, 1.041687, 1.0436460000000001, 1.0453539999999999, 1.0468120000000001, 1.04802, 1.048978, 1.0496859999999999, 1.050144, 1.050352, 1.050311, 1.050019, 1.049477, 1.0486850000000001, 1.0476430000000001, 1.046351, 1.0448090000000001, 1.0430170000000001, 1.0409759999999999, 1.0386839999999999, 1.0361419999999999, 1.03335, 1.030308, 1.0270159999999999, 1.023474, 1.019682, 1.015641, 1.0113490000000001, 1.006807, 1.0020150000000001, 0.996973, 0.99168100000000003, 0.98613899999999999, 0.98034699999999997, 0.97430600000000001, 0.96801400000000004, 0.96147199999999999, 0.95467999999999997, 0.94763799999999998, 0.94034600000000002, 0.93280399999999997, 0.92501199999999995, 0.91697099999999998, 0.90867900000000001, 0.90013699999999996, 0.89134500000000005, 0.88230299999999995, 0.87301099999999998, 0.86346900000000004, 0.85367700000000002, 0.84363600000000005, 0.83334399999999997, 0.82280200000000003, 0.81201000000000001, 0.80096800000000001, 0.78967600000000004, 0.77813399999999999, 0.76634199999999997, 0.754301, 0.74200900000000003, 0.72946699999999998, 0.71667499999999995, 0.70363299999999995, 0.69034099999999998, 0.67679900000000004, 0.66300700000000001, 0.64896600000000004, 0.63467399999999996, 0.62013200000000002, 0.60533999999999999, 0.59029799999999999, 0.57500600000000002, 0.55946399999999996, 0.54367200000000004, 0.52763099999999996, 0.51133899999999999, 0.49479699999999999, 0.47800500000000001, 0.46096300000000001, 0.44367099999999998, 0.42612899999999998, 0.40833700000000001, 0.39029599999999998, 0.372004, 0.353462, 0.33467000000000002, 0.31562800000000002, 0.29633599999999999, 0.27679399999999998, 0.25700200000000001, 0.236961, 0.216669, 0.196127, 0.17533499999999999, 0.15429300000000001, 0.13300100000000001, 0.111459, 0.089666999999999997, 0.067626000000000006, 0.045333999999999999, 0.022792};
double u_sensors_199_error01[] = {0.031301492116254812, 0.019967068274265733, 0.055057296435569968, 0.061678252775299119, 0.088508654646350257, 0.082861459219190844, 0.090250155226784312, 0.13244101838347561, 0.14542652532467121, 0.13007164948906186, 0.14838594837801627, 0.16508250180847681, 0.17605247319717843, 0.1753721066636845, 0.22392565456642727, 0.21201369140216028, 0.23663329593083279, 0.25607343392795429, 0.27820179560821162, 0.28367404625200321, 0.30519114331260194, 0.3215061042866641, 0.32796861067680061, 0.33006201393990681, 0.35896802675985107, 0.34528153073363416, 0.37095302802226343, 0.39924800350832035, 0.40244161944826629, 0.43043552427874215, 0.43685366298021699, 0.44001281538362474, 0.45367158367455424, 0.4817281458236905, 0.49651976832365441, 0.49251976520282847, 0.51395546157632543, 0.53350163114727434, 0.52519182123907082, 0.55083615741778547, 0.573113699870337, 0.57888852528647083, 0.58551108843776101, 0.59033723779507508, 0.59798615919109865, 0.63545409490837579, 0.64928884857416758, 0.63373370481395974, 0.66147990694824332, 0.67624342508297175, 0.70186924974671072, 0.71086584115011653, 0.69044108903290924, 0.71494270984965125, 0.71677053244342281, 0.7363590225663692, 0.74715698046396306, 0.76435544914572962, 0.77114387094969161, 0.7903250112025052, 0.79735754240282453, 0.82386800454407005, 0.82871464289370833, 0.81796553387366633, 0.83299944082432542, 0.85945093305225073, 0.85635823164332692, 0.8689008762745799, 0.87397397241237762, 0.89492967321274519, 0.89462197576599989, 0.88508809621950957, 0.91780587290116766, 0.92229123063075746, 0.92167101839050858, 0.92423000465533356, 0.92084438111177314, 0.92211392070556886, 0.95693019318180672, 0.9627367603405137, 0.97085968353577934, 0.96980408305701615, 0.9757539530284397, 0.9674825412164052, 0.95978297507184573, 0.97337621657883977, 0.9939167367374393, 0.98998395698884856, 1.0225421405735817, 1.0051800263838373, 1.026029717995645, 1.0024025652802606, 1.0057958748533167, 0.99936505999582392, 1.0252715037035227, 1.0441129712914878, 1.0463966959189634, 1.0290020763124568, 1.0176423794259102, 1.0448295386730364, 1.0454441678854671, 1.0482607734405933, 1.0249230369972102, 1.0299485966486464, 1.0412606058827651, 1.0449099123141286, 1.0341745027145666, 1.0645945200297315, 1.0489539952270341, 1.0467990820121018, 1.0518069865311135, 1.0628659066103996, 1.0679072156270573, 1.0379558811658809, 1.0289904267175134, 1.0365113920390729, 1.0342273301365823, 1.0376431130914401, 1.0209534294108222, 1.0280619488313549, 1.0176342664522799, 1.0274350962323249, 1.0239419663656126, 1.0260705237890317, 1.0077783796559929, 1.0094491703841419, 1.001876997803129, 1.0080550365508345, 0.99079211653668131, 1.0015758044445704, 0.99676672368924246, 0.96156918492528087, 0.9691005188131615, 0.97463542354838206, 0.96393863371730926, 0.95200299918319176, 0.94597797655925986, 0.93759790762363027, 0.93787325032631186, 0.91828953236855448, 0.90395633617903992, 0.92008145525823515, 0.92327452665749854, 0.90650405437274395, 0.87172112575786864, 0.87766964899782629, 0.86332004532416051, 0.84761200549980176, 0.84284830591230564, 0.83831669181648505, 0.82000343846270829, 0.82986358145287376, 0.79896591544136752, 0.78313193748673005, 0.80119916921527135, 0.76364794288593052, 0.74535658598305576, 0.74406819829119009, 0.72897048041933887, 0.73449419349729084, 0.71210952667721317, 0.68798674622616363, 0.68752815112493404, 0.66934379251426956, 0.65042485424304175, 0.6342567965321928, 0.62008777125231596, 0.6051712490691693, 0.59064527024868341, 0.57997798825804125, 0.56004020134372656, 0.53782793948500274, 0.52174163444727295, 0.51154470593066881, 0.48709803426430609, 0.48259512175154845, 0.4476955731862956, 0.45178508244174642, 0.40975571642208908, 0.41036258884559107, 0.3890397140257264, 0.37459537691603945, 0.34593973655528543, 0.34958507056826665, 0.31043597689123498, 0.28839049862273614, 0.27599505555607057, 0.25396464146300501, 0.23837816530476613, 0.2342200447899089, 0.19293198739809034, 0.17837802070372832, 0.15369995062355113, 0.14375304120088306, 0.12685482274535809, 0.089520433469101712, 0.053283515316853783, 0.052044308638826316, 0.012615320516641482};
double u_sensors_199_error05[] = {0.02537325853715881, 0.003816217816428609, -0.033165308010069131, 0.058174028621375107, -0.02761884971127114, 0.14844088451600773, 0.078422342579250973, 0.095641663844292041, 0.092900737081622012, 0.14990861648162981, 0.22240422480093627, 0.16923709160949424, 0.27610970445486838, 0.22117975989892324, 0.18740503704108979, 0.32366420247469241, 0.20267065832339043, 0.28827411344361631, 0.17350600276465972, 0.31921210922203902, 0.20748908204494521, 0.32575462436803349, 0.34616251736787135, 0.35814919282218277, 0.37334402158456403, 0.34517782397062508, 0.44165299906322886, 0.42940101029485522, 0.43951203098403113, 0.3887216710250988, 0.43273568864954937, 0.42142861972600298, 0.35363873110934135, 0.42549404375530381, 0.4480963215178122, 0.53642440395021718, 0.45000143072988585, 0.51802073778490876, 0.51236090434363868, 0.50175670094075486, 0.49391202764861403, 0.59476756639277051, 0.54342508246073518, 0.66530760646875531, 0.6606281139101946, 0.5731640046710248, 0.65630216273283104, 0.60918553074046611, 0.65505858309516485, 0.66344389490088307, 0.68970432354802513, 0.59061512651505965, 0.77612442937721493, 0.75250408292028292, 0.76310221398509426, 0.79251510377667, 0.74731699292934062, 0.77881450243509664, 0.78328149290933169, 0.79647568765570265, 0.78033885608794318, 0.76939244331226675, 0.89227157557657133, 0.70236687104573736, 0.93937417398584666, 0.80076726100800766, 0.84426816340784905, 0.83910552943500327, 0.79288461486579531, 0.90166803232302706, 0.91770676769701409, 0.91428271427589847, 0.93821190111407582, 1.0289033828284402, 0.92209717944131342, 0.88980338210271592, 0.89300901395478682, 0.89187899021135753, 0.90889250056962512, 0.91276261911605305, 0.90078349304821181, 1.0101716167277517, 0.91005749524821766, 1.0791881380660768, 1.02300015636963, 0.92191576825107358, 1.1206599446276231, 1.0352173295994178, 1.0210328512915856, 1.0304205052072613, 0.93711920982149333, 1.0317187643322756, 1.0029053184569789, 1.1087224316779141, 1.0953275505703959, 1.1173023226438081, 1.0211010400589609, 1.0529907605784565, 0.99280857440802173, 1.1002500200462091, 0.96884727088885125, 1.0010870827375855, 1.1173690099553246, 1.0385921585674953, 1.0121385720097187, 1.0505710678172628, 1.1306464507852614, 1.047567216864403, 1.0140488516607591, 1.0123384234290065, 1.0612069174938807, 1.077692182891437, 1.0163393460372472, 1.1074742433941553, 1.0048586928557475, 1.0512207608064499, 1.1678144025046229, 1.0466685409967234, 1.0685094738325838, 1.0374474838897489, 1.013661773177154, 1.0486588240123702, 1.1059489060467427, 1.0389624830606505, 1.0243874496431831, 1.0228099682212817, 0.99316320203610509, 0.93580365371310525, 0.97935585065255537, 0.99556562499739465, 1.018412496006027, 1.098709969129078, 0.97131534429591049, 0.99240215708394741, 1.0115821491362862, 1.008645508252928, 1.0400808571649265, 0.89615269780781059, 0.92974988552080062, 0.96569965454611661, 0.95622715116210488, 0.98036660465407199, 0.94043546981475523, 0.93761055570503782, 0.92053180345255226, 0.86190097882515371, 0.78296831266494993, 0.76554501457821222, 0.82576020958900687, 0.94850184135978366, 0.87684550777242676, 0.79612983866025511, 0.83715731890803879, 0.76633784771107316, 0.80463196445064966, 0.80626974462634349, 0.76478837639004349, 0.7443395972955158, 0.72445576682243851, 0.72799991478540937, 0.63935629037420338, 0.77019092785900767, 0.65746470024127202, 0.62983529171331554, 0.67078454230359141, 0.63560294214236324, 0.67362538283321138, 0.53192517814572482, 0.65988775012650713, 0.59458916753805202, 0.4829885356156462, 0.64029981059811414, 0.53482180063065599, 0.54141873982734723, 0.50095375948329257, 0.47491650441849942, 0.49686984369972365, 0.46817858001133872, 0.45971621156834402, 0.37948806343163344, 0.38101837614902034, 0.34783046173961696, 0.38508001366279487, 0.36756522264989183, 0.3063482512822418, 0.40046511983196886, 0.30738013950594445, 0.20621258542492629, 0.25669808147712514, 0.19409827582750694, 0.22292930589155152, 0.17977136030381663, 0.13562120223441118, 0.13154622964735946, 0.084285086456442629, 0.067692111867778404, 0.0022122665538336223, 0.13395344517702709, 0.097809044910798226, -0.0027798620033444186};

int data[] = {
    PJ_INVERSE_UNKNOWN_SOURCE, PJ_ELLIPTIC_PROBLEM, 1, 0,

    FUNCTIOAL_SQUARE, 1, 4, 2, 0,

    100, 0,

    1, 0,
    1, 0,

    N_SENSORS, 1,

    NORMALIZED | RADIAL | GAUSSIAN, 8, 1, 0,  2, 0, 0, 0,
    NORMALIZED | RADIAL | GAUSSIAN, 8, 1, 0,  0, -1, -1, -1,
};

#define C_k 0.05

double bounds[] = {
    GP_UNIFORM_SOLID_CUBOID, 0.0, 1.0, // A

    GP_POINTS, 0.0,
    GP_POINTS, 1.0,

    GP_GRID_1D, N_SENSORS, C_h, 1-C_h,
};


ANNS_CND(A) {return C_k * u_xx[0][0] + u[1];}
ANNS_CND(B) {return u[0];}
ANNS_CND(S) {return u[0] - v[0];}

ANNS_CND_G(A_a) {return C_k * u_axx[0];}
ANNS_CND_G(B_a) {return u_a;}

fbvp_t cond[] = {A, B, B, S};
gbvp_t cond_a[] = {
    A_a, B_a, B_a, B_a,
    B_a, NULL, NULL, NULL,
};

double delta[] = {1, 1, 1, 1};

void ai_init(anns_instance_t *ai) {
    ai_conditions(ai, cond, cond_a, NULL);
    ai_loadfuncs(ai);
}

void ai_reload(anns_instance_t *ai) {
    ai_genpoints(ai, bounds);
//    ai_eval_v(ai, 0, 0, A_f, NULL);
    ai_load_v(ai, 3, 0, u_sensors_199_exact);
}

void ai_initann(anns_instance_t *ai, double *x) {
    int i, j, t, n, s;

    for (t = 0; t < ai->nnets; t++) {
        for (i = ai->I[t]; i < ai->I[t+1]; ) {
            x[i++] = uniform(-4., 4.);   // Веса
            x[i++] = uniform(0.5, 2.);   // Ширины
            x[i++] = uniform(-0.5, 1.5); // Центры
        }
    }
}

double ai_mse(anns_instance_t *ai, double *x) {
    double hx = 0.001;
    int i, n = (int)(1./hx) + 1;
    double point[] = {0.0};
    double mse = 0, tmp;
//    point[1] = 1.0;
//    for (point[0] = 0.0; point[0] < M_PI; point[0] += hx) {
    for (i = 0; i < n; i++) {
        point[0] = hx*i;

        tmp = ( (point[0] <= 0.5) ? point[0] : 0.5) - anns_evalsingle(1, point, x, ai);
//        tmp = bi->cache->u[0] -g(point, 1, NULL);
//        tmp = f(point, 1, NULL) - anns_evalsingle(1, point, x, bi);
        mse += tmp*tmp;
    }

    return sqrt(mse*hx);
}

#endif // ANNS_TASK
