#ifndef IBND_PAR_2_H_INCLUDED
#define IBND_PAR_2_H_INCLUDED

#define ERROR_SWITCH 3

#if ERROR_SWITCH==0
// Без ошибки
double U_sensors[] = {0.0, 1.9999999999999999e-006, 1.2999999999999999e-005, 5.1e-005, 0.00014100000000000001, 0.00031700000000000001, 0.00061799999999999995, 0.0010839999999999999, 0.0017539999999999999, 0.0026610000000000002, 0.0038370000000000001, 0.005306, 0.0070879999999999997, 0.0091999999999999998, 0.011653, 0.014456, 0.017613, 0.021128000000000001, 0.025000999999999999, 0.029231, 0.033814999999999998, 0.038752000000000002, 0.044034999999999998, 0.049660000000000003, 0.055621999999999998, 0.061914999999999998, 0.068532999999999997, 0.075468999999999994, 0.082716999999999999, 0.090271000000000004, 0.098123000000000002, 0.106268, 0.11469799999999999, 0.123408, 0.13239000000000001, 0.14163899999999999, 0.15114900000000001, 0.160912, 0.17092399999999999, 0.18117800000000001, 0.19166800000000001, 0.20238900000000001, 0.213335, 0.22450200000000001, 0.23588300000000001, 0.247473, 0.259268, 0.271262, 0.28344999999999998, 0.29582900000000001, 0.30839299999999997, 0.321133, 0.33403100000000002, 0.347049, 0.36013000000000001, 0.37320300000000001, 0.386185, 0.39899299999999999, 0.411547, 0.42377399999999998, 0.43560900000000002, 0.44699800000000001, 0.45789800000000003, 0.46827400000000002, 0.478099, 0.48735400000000001, 0.49602400000000002, 0.50410100000000002, 0.51158000000000003, 0.51846199999999998, 0.52474699999999996, 0.53044000000000002, 0.535547, 0.54007499999999997, 0.54403100000000004, 0.54742599999999997, 0.55027000000000004, 0.55257199999999995, 0.55434300000000003, 0.55559400000000003, 0.55633500000000002, 0.55657900000000005, 0.55633600000000005, 0.555616, 0.55443100000000001, 0.55279100000000003, 0.55070699999999995, 0.54818900000000004, 0.54524700000000004, 0.54189200000000004, 0.538134, 0.53398100000000004, 0.529443, 0.52453000000000005, 0.51925100000000002, 0.51361400000000001, 0.50762799999999997, 0.50130200000000003, 0.494643, 0.48765999999999998, 0.48036099999999998};
#elif ERROR_SWITCH==1
// Нормальная ошибка, ампилитуда 0.0025, радиус 1.0
double U_sensors[] = {0.0, -0.0037286485795059248, -0.0040294964492783285, -0.0026666889802128236, 0.0018603136228428653, 0.0029743049754162886, 0.0021385971301355997, 0.0021210363779898623, 0.00052203705032901888, 0.0028289691673667179, 0.0028503089927489232, 0.0017442417597901437, 0.0043231500844079342, 0.011050852842549769, 0.016340435634103253, 0.012946768713643871, 0.020889680500751004, 0.021924780548251477, 0.021673417905253921, 0.029576864637688056, 0.031422425494181283, 0.039950576454200845, 0.045048979644432857, 0.051709343749695359, 0.054242040174810796, 0.061524085990285381, 0.065725249266203239, 0.068136210340270925, 0.083210366566282654, 0.091764980667333837, 0.10164122023785349, 0.10444683831765669, 0.11305461178192713, 0.12305019984315073, 0.13265115920428774, 0.14111762185488647, 0.151720729371501, 0.16209425585627152, 0.17107186830864524, 0.18579092713997938, 0.19429085891617123, 0.2045912182605894, 0.21723785151380265, 0.22438312328887638, 0.23591600270853866, 0.25064414476980407, 0.2574060713469542, 0.27023931229175235, 0.28078327886100257, 0.29776404564924691, 0.30804787148188301, 0.32343362417028593, 0.3311839792886363, 0.34594378675029347, 0.36044765510279564, 0.37385221933380136, 0.38677252385535199, 0.39884617957793861, 0.41287279556638068, 0.42091562095776824, 0.44228481905146944, 0.44442975660330064, 0.45682461095598637, 0.4710192695587182, 0.48118985759590988, 0.48948355917035041, 0.49569315573645989, 0.50802757796960796, 0.5111958611746793, 0.51976317482193757, 0.52435740772408856, 0.52934361921607653, 0.53761389541855709, 0.5378923168977936, 0.54358515793155471, 0.54724191099524844, 0.54940006022898757, 0.55718874573479582, 0.5541872324294056, 0.55519258768661284, 0.55627223444151952, 0.55527739876549909, 0.5530644336903886, 0.55845170321579285, 0.5547941938972849, 0.54887578197554432, 0.55261539069132015, 0.5501872544359151, 0.54506178360996538, 0.54024512135649905, 0.53699020997300428, 0.53525917535977041, 0.52959280449866619, 0.52713019189757671, 0.52319526095384328, 0.51693785185943564, 0.51218901004428374, 0.50008253403526914, 0.49691339426796022, 0.4856588647845726, 0.47739959052397918};
#elif ERROR_SWITCH==2
// Нормальная ошибка, ампилитуда 0.01, радиус 1.0
double U_sensors[] = {0.0, -0.014920594318023698, -0.016156985797113315, -0.010819755920851293, 0.0070182544913714607, 0.010946219901665154, 0.0067003885205423989, 0.0052321455119594502, -0.0031738517986839242, 0.0033328766694668706, -0.00010976402900430681, -0.0089410329608394252, -0.0039713996623682623, 0.016603411370199082, 0.030402742536413015, 0.0084190748545754802, 0.030719722003004019, 0.024315122193005904, 0.011690671621015683, 0.030614458550752219, 0.024244701976725139, 0.043546305816803375, 0.048090918577731442, 0.057857374998781422, 0.050102160699243184, 0.060351343961141522, 0.057301997064812968, 0.046137841361083745, 0.084690466265130618, 0.096246922669335322, 0.11219588095141397, 0.098983353270626767, 0.10812444712770856, 0.12197679937260288, 0.13343463681715093, 0.13955348741954593, 0.15343591748600399, 0.16564102342508608, 0.17151547323458102, 0.19962970855991749, 0.20215943566468486, 0.2111978730423576, 0.22894640605521058, 0.22402649315550549, 0.23601501083415463, 0.26015757907921638, 0.25182028538781676, 0.26717124916700935, 0.27278311544401024, 0.30356918259698767, 0.30701248592753216, 0.33033549668114359, 0.32264291715454502, 0.34262814700117389, 0.36140062041118259, 0.37579987733520548, 0.38853509542140791, 0.39840571831175442, 0.41685018226552284, 0.41234048383107302, 0.46231227620587778, 0.4367250264132026, 0.45360444382394538, 0.47925507823487273, 0.49046243038363951, 0.49587223668140162, 0.4947006229458395, 0.51980731187843154, 0.51004344469871699, 0.52366669928775045, 0.52318863089635437, 0.52605447686430584, 0.54381458167422836, 0.53134426759117448, 0.54224763172621859, 0.54668964398099396, 0.54679024091595008, 0.57103898293918365, 0.55371992971762241, 0.55398835074645114, 0.55608393776607812, 0.55137259506199621, 0.54324973476155425, 0.56695881286317118, 0.55588377558913971, 0.53713012790217696, 0.55834056276528099, 0.55618201774366016, 0.5445061344398614, 0.53530448542599596, 0.53355883989201713, 0.53909370143908142, 0.53004221799466489, 0.53493076759030667, 0.53502804381537317, 0.52690940743774251, 0.52587204017713529, 0.49642413614107639, 0.50372457707184082, 0.47965545913829039, 0.46851536209591688};
#else
// Нормальная ошибка, ампилитуда 0.02, радиус 1.0
double U_sensors[] = {0.0, -0.0069234156914743366, 0.0041271591318056532, -0.027009664636085937, -0.016545206512286418, -0.021874505847646459, 0.017328194242158767, -0.0025518660686961432, -0.017031821501511498, -0.020590337525219181, 0.037970804993983254, 0.025362065064838714, 0.0056786387780151494, 0.010439129548924189, 0.021234316093617697, 0.017304572486087934, 0.043414642631931205, 0.041395776070971529, 0.02599848927379092, 0.0081844137563243137, 0.039063210370968791, 0.077153904274391033, 0.054797222276795517, 0.040518497630438084, 0.057062599697011954, 0.066124610746102763, 0.10179347430711019, 0.079154191508414032, 0.062073928381883629, 0.089543951882530337, 0.085616830435287172, 0.098276354053164761, 0.15136122345590608, 0.14065702994218743, 0.12967309502700416, 0.12693815807897083, 0.1517596206734079, 0.15752001934893695, 0.19625645465590036, 0.21312940474270239, 0.19396268020862611, 0.18044713834059664, 0.18741463931455662, 0.21069769238861713, 0.25083841149392783, 0.23947749864651185, 0.25677598659564943, 0.24218659207832433, 0.29928111066470231, 0.30353938909940353, 0.30486557005599485, 0.3389529187669113, 0.32153476210413956, 0.35265803930203515, 0.35529390033163594, 0.37633952041330127, 0.37875094249532321, 0.3735565484676841, 0.39743856599014593, 0.44037736460262394, 0.42994448338834484, 0.41219790737524864, 0.44103055980971295, 0.48669857945487027, 0.46504624473181533, 0.50914154730092864, 0.5242151191704546, 0.50166780979033776, 0.49692214555747122, 0.52540490046725286, 0.51482775619803389, 0.54729096434331215, 0.52120853144324442, 0.52943977338750403, 0.56785296063634316, 0.54383535385794801, 0.5646456065816059, 0.57683206082806726, 0.59925563971016882, 0.54163525505641574, 0.57579667349669572, 0.5191974763415298, 0.56310726724818361, 0.54095354371299909, 0.5436989987162818, 0.52351808724375093, 0.54609493206295023, 0.58626109997210896, 0.54017107208489856, 0.52056293336200099, 0.56407110170489105, 0.51932727464656248, 0.50325088192662393, 0.54728005682238912, 0.50894928642584636, 0.47356626170748939, 0.49699347899929852, 0.48866979319774168, 0.4919357616961666, 0.46111315338265263, 0.50561124010660941};
#endif

#define NP_UB 101

//#include "../bvp/bvp_ann.h"

// x[0] - x
// x[1] - t

#define NP_OMEGA     100
#define NP_INSULATED 20
#define NP_INITIAL   20

int data[] = {
    PJ_INVERSE_UNKNOWN_BOUNDARY, PJ_PARABOLIC_PROBLEM, 2, 0,

    FUNCTIOAL_SQUARE, 2, 4, 1, 0,

    NP_OMEGA, 0, // Уравнение переноса
    NP_INSULATED, 0,  // Изолированная сторона
    NP_INITIAL, 0,  // Начальное условие

    NP_UB, 1, // Измеренная температура на изолированной стороне

    NORMALIZED | RADIAL | GAUSSIAN, 64, 2, 0,  2, 1, 0, 0,
};


double bounds[] = {
    GP_UNIFORM_SOLID_CUBOID, 0.0, 1.0,  0.0, 1.0, // Уравнение переноса
    GP_UNIFORM_SOLID_CUBOID, 0.0, 0.0,  0.0, 1.0, // Изолированная сторона
    GP_UNIFORM_SOLID_CUBOID, 0.0, 1.0,  0.0, 0.0, // Начальное условие

    GP_GRID_2D, 1, 0.0, 0.0, NP_UB, 0.0, 1.0,
};



//ANNS_FUN(F_u) {return VELOCITY*x[0]*(1 - x[0]);}

ANNS_CND(Ctransfer)   {return u_xx[0][0] - u_x[0][1];}
ANNS_CND(Cinsulated)  {return u_x[0][0];}
ANNS_CND(Cleft)       {return u[0];}
ANNS_CND(Csensors)    {return u[0] - v[0];}

ANNS_CND_G(Ctransfer_a)  {return u_axx[0] -  u_ax[1];}
ANNS_CND_G(Cinsulated_a) {return u_ax[0];}
ANNS_CND_G(Cleft_a)      {return u_a;}
ANNS_CND_G(Csensors_a)   {return u_a;}

fbvp_t cond[] = {Ctransfer, Cinsulated, Cleft, Csensors};
gbvp_t cond_a[] = {Ctransfer_a, Cinsulated_a, Cleft_a, Csensors_a};
double delta[] = {1./NP_OMEGA, 1./NP_INSULATED, 1./NP_INITIAL, 1./NP_UB};

void ai_init(anns_instance_t *ai) {
    ai_conditions(ai, cond, cond_a, delta);
    ai_loadfuncs(ai);
}

void ai_reload(anns_instance_t *ai) {
    ai_genpoints(ai, bounds);
    ai_load_v(ai, 3, 0, U_sensors);
}

void ai_initann(anns_instance_t *ai, double *x) {
    int i, j, t, n, s;

    for (t = 0; t < ai->nnets; t++) {
        for (i = ai->I[t]; i < ai->I[t+1]; ) {
            x[i++] = uniform(-3., 3.);         // Веса
            x[i++] = uniform(0.25, 1.25);        // Ширины
//            x[i++] = 1.0/sqrt(ai->nn[0]);
            x[i++] = uniform(-0.25, 1.25);       // Центры
            x[i++] = uniform(-0.25, 1.25);       // Центры
        }
    }
}

double ai_mse(anns_instance_t *ai, double *x) {
    int p, npoints = 101;
    double hx = 1./(npoints-1);
    double point[] = {1.0, 0.0};
    double mse = 0, tmp;

    for (p = 0; p < npoints; p++) {
        tmp = anns_eval(point, x, ai);
        tmp -= (point[1] < 0.5) ? 2*point[1] : 2-2*point[1];
        mse += tmp*tmp;
        point[1] += hx;
    }

    return sqrt(mse / (npoints-1));
}

#endif // IBND_PAR_2_H_INCLUDED
