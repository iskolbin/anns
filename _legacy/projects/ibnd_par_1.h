#ifndef IBND_PAR_E1_H_INCLUDED
#define IBND_PAR_E1_H_INCLUDED

#define ERROR_SWITCH 2

#if ERROR_SWITCH==0
double U_sensors[] = {0.0, 0.0, 1.9999999999999999e-006, 7.9999999999999996e-006, 2.5999999999999998e-005, 6.6000000000000005e-005, 0.000144, 0.00027999999999999998, 0.00049399999999999997, 0.00081300000000000003, 0.001261, 0.0018630000000000001, 0.0026440000000000001, 0.0036250000000000002, 0.0048279999999999998, 0.0062709999999999997, 0.0079690000000000004, 0.0099369999999999997, 0.012184, 0.014722000000000001, 0.017555000000000001, 0.020691000000000001, 0.024129999999999999, 0.027876000000000001, 0.031928999999999999, 0.036285999999999999, 0.040946000000000003, 0.045905000000000001, 0.051159000000000003, 0.056701000000000001, 0.062525999999999998, 0.068626000000000006, 0.074993000000000004, 0.081619999999999998, 0.088497000000000006, 0.095614000000000005, 0.102962, 0.110531, 0.118309, 0.12628600000000001, 0.13444999999999999, 0.142789, 0.15129300000000001, 0.15994800000000001, 0.168743, 0.17766499999999999, 0.18670200000000001, 0.19583999999999999, 0.205068, 0.21437200000000001, 0.22373999999999999, 0.233158, 0.242613, 0.25209300000000001, 0.26158500000000001, 0.27107500000000001, 0.28055099999999999, 0.28999900000000001, 0.29940800000000001, 0.30876399999999998, 0.318054, 0.327266, 0.33638800000000002, 0.34540700000000002, 0.35431200000000002, 0.363089, 0.371728, 0.38021700000000003, 0.388544, 0.396698, 0.404667, 0.41244199999999998, 0.42001100000000002, 0.42736499999999999, 0.43449199999999999, 0.441384, 0.44802999999999998, 0.45442100000000002, 0.46054899999999999, 0.46640500000000001, 0.47198000000000001, 0.47726600000000002, 0.48225499999999999, 0.48694100000000001, 0.491315, 0.49537100000000001, 0.49910300000000002, 0.50250499999999998, 0.50557099999999999, 0.50829599999999997, 0.51067399999999996, 0.51270199999999999, 0.514374, 0.51568800000000004, 0.51663899999999996, 0.51722500000000005, 0.51744299999999999, 0.51729099999999995, 0.51676599999999995, 0.51586799999999999, 0.51459600000000005};
#elif ERROR_SWITCH==1
double U_sensors[] = {0.0013943485507595063, -0.00059110016210491131, 0.0029294749475492626, -0.0027170083959458706, 0.00097211428579126462, -0.0039014768830385382, -0.0018572981712085524, 0.0017099756380647771, -0.0021474239176836646, -0.00089621304248278181, 0.0025240176606758855, 0.00078938690994533934, 0.0033125735652926153, 0.0034456127932299989, 0.005142028007664284, 0.0035754311462864855, 0.0066056365050735956, 0.01158600485405613, 0.011609731113344509, 0.017113775358705584, 0.014394154286911657, 0.017596763556782091, 0.023036341910432166, 0.026689312696786715, 0.033571018320606591, 0.040942374474130981, 0.038683982898516517, 0.045931395679955418, 0.048675148171205163, 0.053481441103157973, 0.062608591355104909, 0.068383929987187314, 0.077831808660772578, 0.078503969569151746, 0.08522773650899311, 0.092267714860802236, 0.10243270920891967, 0.10881109493233312, 0.11719989866956407, 0.12218715065552029, 0.13227743634561739, 0.14382538565743919, 0.15054591257443001, 0.16118026548946965, 0.17113960492488994, 0.17845228483904502, 0.18843482001633022, 0.19866394650055275, 0.20594598329604891, 0.21636764762715902, 0.22020720080091524, 0.23508194847909142, 0.24268895987069081, 0.25412529454867916, 0.26388990512382515, 0.26675901326605017, 0.27697617979208317, 0.28683356526175813, 0.30291176461565555, 0.30425267219014751, 0.31926894571658387, 0.32736882470415607, 0.33783515653844881, 0.34771805635165531, 0.3541518896222165, 0.35901418778735961, 0.3719319531740472, 0.38028094095445797, 0.3865534783001589, 0.3976633473707169, 0.4053853360991988, 0.41247331112986518, 0.42001637457770197, 0.42619715824721371, 0.43786831307440133, 0.44218361654042049, 0.45048364940456287, 0.4596850955783976, 0.46689199295132949, 0.46468154489896191, 0.47245882307073039, 0.47999758993925878, 0.48133905484977946, 0.48554056710021909, 0.48661864929051196, 0.4972200640264906, 0.50323399039502459, 0.50574666720845274, 0.50551528743606766, 0.50677530827871931, 0.5122878635358451, 0.50726431039284003, 0.51587774391900343, 0.51335914985601738, 0.5178617910768466, 0.51728530597742206, 0.51575273220855278, 0.51630196955414376, 0.51433837873267585, 0.52125624943655857, 0.51407794138514473};
#elif ERROR_SWITCH==2
double U_sensors[] = {0.005577394203038025, -0.0023644006484196452, 0.011711899790197051, -0.010892033583783484, 0.0038104571431650585, -0.015803907532154153, -0.0078611926848342097, 0.0059999025522591088, -0.010071695670734659, -0.006023852169931127, 0.006313070642703541, -0.0024314523602186429, 0.0053182942611704606, 0.0029074511729199944, 0.0060841120306571366, -0.0045112754148540568, 0.0025155460202943803, 0.016533019416224523, 0.0098869244533780348, 0.024289101434822338, 0.0049116171476466242, 0.0083140542271283608, 0.019755367641728663, 0.023129250787146859, 0.03849707328242636, 0.054911497896523928, 0.031897931594066044, 0.046010582719821669, 0.041223592684820641, 0.043822764412631887, 0.062856365420419655, 0.067657719948749237, 0.086348234643090327, 0.069155878276606964, 0.075419946035972407, 0.082228859443208957, 0.1008448368356787, 0.1036513797293325, 0.11387259467825626, 0.1098906026220811, 0.12575974538246965, 0.14693454262975669, 0.14830465029771994, 0.1648770619578786, 0.17832941969955973, 0.18081413935618007, 0.19363328006532082, 0.20713578600221108, 0.20857993318419568, 0.22235459050863604, 0.20960880320366104, 0.24085379391636566, 0.24291683948276324, 0.26022217819471666, 0.27080462049530052, 0.25381105306420071, 0.26625171916833268, 0.27733726104703255, 0.31342305846262214, 0.29071868876059004, 0.32291378286633554, 0.32767729881662422, 0.34217662615379529, 0.35465122540662114, 0.35367155848886589, 0.34678975114943839, 0.3725438126961888, 0.3804727638178319, 0.38058191320063561, 0.40055938948286751, 0.4075403443967951, 0.41256724451946081, 0.4200324983108078, 0.42269363298885498, 0.44799725229760534, 0.44458246616168207, 0.45784459761825153, 0.47547738231359032, 0.48592097180531812, 0.45951117959584747, 0.4738952922829216, 0.48819235975703518, 0.47859121939911792, 0.48133926840087637, 0.47252959716204779, 0.5027672561059624, 0.51562696158009846, 0.51547166883381113, 0.50534814974427067, 0.5022132331148772, 0.51712945414338063, 0.49095124157136011, 0.52038897567601383, 0.50637259942406931, 0.52153016430738652, 0.51746622390968811, 0.51068192883421126, 0.51333487821657497, 0.50705551493070367, 0.53742099774623409, 0.51252376554057888};
#else
double U_sensors[] = {-0.005409543674378188, -0.0019610936962817277, -0.02005689788017068, 0.037159139385158135, -0.0074932911350701851, -0.030600691282485954, -0.015403479854039321, 0.0028042725283287284, -0.039647199391841567, 0.009270942068519767, 0.0025588309639173936, 0.029390599211061418, -0.028060446582073809, 0.037385778749368014, 0.025325993236664585, 0.044753529255655976, 0.014638189861810555, -0.0070740411641770692, 0.020616945698432816, 0.028815396915603652, -0.025341275242019526, 0.027824011187972633, 0.035742373404350165, 0.032661431193796706, 0.048376567279405314, 0.04281936554762119, 0.069209265357575683, 0.012470696565564286, 0.041987488401688297, 0.060094651539944519, 0.042767306643085125, 0.072698047152764664, 0.079677225212878858, 0.10336466996096112, 0.050271227607744537, 0.099547770678867123, 0.11268711563498794, 0.11858853672633721, 0.10410016490125451, 0.12099266320830174, 0.11663878923395199, 0.12952018405579352, 0.16492712700212592, 0.15998130468734659, 0.17469852882699893, 0.1845693133161436, 0.19479808684760175, 0.17718242600916606, 0.19054567576504372, 0.25890422368947563, 0.20676229819685049, 0.21365076548502546, 0.25084919023288599, 0.25346130681871637, 0.26157661428306866, 0.24246243005927501, 0.22177213170890386, 0.2845335673001021, 0.27925511004555276, 0.30428077550289889, 0.35170007052061475, 0.34818168982605219, 0.32756876510249094, 0.34494829343749783, 0.31913164482874501, 0.3722099587416654, 0.37795795463154735, 0.34329965751558356, 0.36426356397062093, 0.38743851587032541, 0.38612918556700088, 0.40751836639099143, 0.39167291456734737, 0.42342510736282085, 0.43172979677305184, 0.42845655975210928, 0.44763959563149219, 0.4417706415562957, 0.42911030003193745, 0.47884660330019158, 0.41993785627874591, 0.48604933923538102, 0.47581583172946357, 0.47716882945597777, 0.50311484063670042, 0.52636612590562193, 0.48551632225690972, 0.49983171713001767, 0.49033556496540442, 0.49667294563571063, 0.57234571531643208, 0.54017487225434535, 0.52207308647001105, 0.51252631897570555, 0.52306807365928032, 0.48782200971979472, 0.53666073161291472, 0.53365161683106321, 0.46346377744141359, 0.54581359474940783, 0.51360004053633457};
#endif

#define N_UB 101
#define VELOCITY 10.0

//#include "../bvp/bvp_ann.h"

// x[0] - x
// x[1] - t

int data[] = {
    PJ_INVERSE_UNKNOWN_BOUNDARY, PJ_PARABOLIC_PROBLEM, 1, 0,

    2, 4, 1, 0,

    100, 1, // Уравнение переноса
    20, 0,  // Изолированная сторона
    20, 0,  // Начальное условие

    N_UB, 1, // Измеренная температура на изолированной стороне

    NORMALIZED | RADIAL | GAUSSIAN, 32, 2, 0,  2, 1, 0, 0,
};


double bounds[] = {
    GP_UNIFORM_SOLID_CUBOID, 0.0, 1.0,  0.0, 1.0, // Уравнение переноса
    GP_UNIFORM_SOLID_CUBOID, 0.0, 0.0,  0.0, 1.0, // Изолированная сторона
    GP_UNIFORM_SOLID_CUBOID, 0.0, 1.0,  0.0, 0.0, // Начальное условие

    GP_GRID_2D, 1, 0.0, 0.0, N_UB, 0.0, 1.0,
};



ANNS_FUN(F_u) {return VELOCITY*x[0]*(1 - x[0]);}

ANNS_CND(Ctransfer)   {return u_xx[0][0] - v[0]*u_x[0][1];}
ANNS_CND(Cinsulated)  {return u_x[0][0];}
ANNS_CND(Cleft)       {return u[0];}
ANNS_CND(Csensors)    {return u[0] - v[0];}

ANNS_CND_G(Ctransfer_a)  {return u_axx[0] -  v[0]*u_ax[1];}
ANNS_CND_G(Cinsulated_a) {return u_ax[0];}
ANNS_CND_G(Cleft_a)      {return u_a;}
ANNS_CND_G(Csensors_a)   {return u_a;}

fbvp2_t cond[] = {Ctransfer, Cinsulated, Cleft, Csensors};
gbvp2_t cond_a[] = {Ctransfer_a, Cinsulated_a, Cleft_a, Csensors_a};
double delta[] = {5.0, 1.0, 10.0, 1.0};

void ai_init(anns_instance_t *ai) {
    ai_conditions(ai, cond, cond_a, delta);
    ai_loadfuncs(ai);
}

void ai_reload(anns_instance_t *ai) {
    ai_genpoints(ai, bounds);
    ai_eval_v(ai, 0, 0, F_u, NULL);
    ai_load_v(ai, 3, 0, U_sensors);
}

void ai_initann(anns_instance_t *ai, double *x) {
    int i, j, t, n, s;

    for (t = 0; t < ai->Nt; t++) {
        for (i = ai->I[t]; i < ai->I[t+1]; ) {
            x[i++] = uniform(-4., 4.);         // Веса
            x[i++] = uniform(0.5, 2.5);        // Ширины
            x[i++] = uniform(-0.5, 1.5);       // Центры
            x[i++] = uniform(-0.5, 1.5);       // Центры
        }
    }
}

double ai_mse(anns_instance_t *ai, double *x) {
    return 0;
}


#endif // IBND_PAR_E1_H_INCLUDED
